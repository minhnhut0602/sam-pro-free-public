(function(n){var t=options.locale.changeLocale?options.locale.locale:"en-US",i=options.wap;n(document).ready(function(){var e=n("#info-dialog"),o=n("#info-body"),r,s={width:830,allowDraggable:!0,enableModal:!0,showOnInit:!1,closeIconTooltip:options.close},u,h=ej.DataManager({url:ajaxurl+"?action=load_error_log&sam_pro_nonce="+options.samProNonce,removeUrl:ajaxurl+"?action=remove_error&sam_pro_nonce="+options.samProNonce,requestType:"json",adaptor:new ej.UrlAdaptor}),i,f;o.html(function(){return'<div style="margin: 10px 10px 10px 0;"><div style="margin: 10px 0;"><aside id="info-img" style="float: left; width: 80px; font-size: 50px;"><\/aside><div style="padding-left: 80px"> <p><strong>'+options.date+'<\/strong>: <span id="el-date"><\/span><\/p><p><strong>'+options.table+'<\/strong>: <span id="el-table"><\/span><\/p><p><strong>'+options.etype[0]+'<\/strong>: <span id="el-type"><\/span><\/p><p><strong>'+options.msg+'<\/strong>:<br><span id="el-msg"><\/span><\/p><p><strong>'+options.sql+'<\/strong>:<\/p><textarea id="el-sql" style="width: 100%; height: 270px;" readonly><\/textarea> <\/div><\/div><\/div>'});r=e.ejDialog(s).data("ejDialog");n("#close-dialog").on("click",function(){r.close()});i=n("#grid").ejGrid({dataSource:h,locale:t,allowTextWrap:!0,allowPaging:!0,allowSorting:!0,pageSettings:{pageSize:options.itemsPerPage},allowSelection:!0,selectionSettings:{selectionMode:[ej.Grid.SelectionMode.Row],enableToggle:!0},editSettings:{allowDeleting:!0},toolbarSettings:{showToolbar:!0,toolbarItems:[ej.Grid.ToolBarItems.Delete],customToolbarItems:[{templateID:"#viewMode"},"Refresh",{templateID:"#MoreInfo"},{templateID:"#ErrorSolved"},{templateID:"#ClearErrors"}]},actionComplete:function(){var i=n("#grid_toolbarItems"),t;t=n("#grid_delete");i.ejToolbar("disableItem",t);t=n("#grid_MoreInfo");i.ejToolbar("disableItem",t);t=n("#grid_ErrorSolved");i.ejToolbar("disableItem",t)},recordClick:function(){var i=n("#grid_toolbarItems"),t,u=this.getSelectedRecords(),r=u.length==0?"disableItem":"enableItem";t=n("#grid_delete");i.ejToolbar(r,t);t=n("#grid_MoreInfo");i.ejToolbar(r,t);t=n("#grid_ErrorSolved");i.ejToolbar(r,t)},toolbarClick:function(t){var o=n(t.target),e=this.getSelectedRecords(),s,h,a,c,v,l,y;o.hasClass("Refresh")?this.refreshContent():o.hasClass("more-info")?e.length>0&&(h=parseInt(e[0].etype,10),s=parseInt(e[0].solved,10),n("#info-img").html(function(){return h==1?"<i class='icon-ok'><\/i>":s==1?"<i class='icon-shield'><\/i>":"<i class='icon-attention'><\/i>"}),n("#el-date").text(e[0].edate),n("#el-table").text(e[0].tname),n("#el-type").text(options.alts[h]),n("#el-msg").text(e[0].emsg),n("#el-sql").html(e[0].esql),r.open()):o.hasClass("error-solved")?e.length>0&&(s=parseInt(e[0].solved,10),s==0&&n.post(ajaxurl,{action:"solve_error",eid:parseInt(e[0].eid,10),sam_pro_nonce:options.samProNonce}).done(function(n){n.success&&i.refreshContent()})):o.hasClass("clear-errors")?n.post(ajaxurl,{action:"clear_error_log",sam_pro_nonce:options.samProNonce}).done(function(n){n.success&&i.refreshContent()}):o.hasClass("Edit")?e.length>0&&(a=e[0].aid,document.location=options.editorUrl+a):o.hasClass("place-to-trash")||o.hasClass("place-from-trash")?(c=o.hasClass("place-to-trash")?1:0,e.length>0&&(v=parseInt(e[0].trash,10),aid=parseInt(e[0].aid,10),v!=c&&n.post(ajaxurl,{action:"trash_ad",aid:aid,trash:c,sam_pro_nonce:options.samProNonce}).done(function(){var n=parseInt(f.getSelectedValue(),10);n==0?i._disabledToolItems.push(u[8]):n==1&&i._disabledToolItems.push(u[7]);i.refreshContent()}))):(o.hasClass("ad-moderate")||o.hasClass("ad-unmoderate"))&&(l=o.hasClass("ad-moderate")?1:0,e.length>0&&(y=parseInt(e[0].moderated,10),aid=parseInt(e[0].aid,10),y!=l&&n.post(ajaxurl,{action:"moderate_ad",aid:aid,mod:l,sam_pro_nonce:options.samProNonce}).done(function(){i.refreshContent()})))},create:function(){var t=n("#grid_toolbarItems");u=t.find("li");n(".more-info").parent("li").attr("title",options.moreInfo);n(".error-solved").parent("li").attr("title",options.setSolved);n(".clear-errors").parent("li").attr("title",options.clearLog);n(".ad-unmoderate").parent("li").attr("title",options.cancelApproval);n('li[title="viewMode"]').attr("title",options.viewMode);n(".Refresh").parent("li").attr("title",options.refresh)},columns:[{field:"eid",headerText:options.id,isPrimaryKey:!0,textAlign:ej.TextAlign.Right,allowSorting:!0,allowEditing:!1,width:100},{field:"stype",headerText:options.etype[1],textAlign:ej.TextAlign.Center,allowSorting:!0,allowEditing:!1,width:100},{field:"edate",headerText:options.date,allowSorting:!0,allowEditing:!1,width:150},{field:"tname",headerText:options.table,allowSorting:!0,allowEditing:!1,width:170},{field:"emsg",headerText:options.msg,allowSorting:!0,allowEditing:!1},{field:"etype",headerText:options.status,allowSorting:!1,allowEditing:!1,visible:!1},{field:"esql",headerText:options.sql,allowSorting:!1,allowEditing:!1,visible:!1},{field:"solved",headerText:options.status,allowEditing:!1,visible:!1}]}).data("ejGrid");f=n("#view-mode").ejDropDownList({selectedItemIndex:0,change:function(){var t=parseInt(this.getSelectedValue(),10);t!=10?n("#grid").ejGrid("model.query",(new ej.Query).where("etype",ej.FilterOperators.equal,t,10)):n("#grid").ejGrid("model.query",new ej.Query);i.refreshContent(!0)}}).data("ejDropDownList")})})(jQuery)