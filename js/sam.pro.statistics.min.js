(function(n){var f=options.locale.changeLocale?options.locale.locale:"en-US",t=options.strings,i=options.wap,r=options.periods[options.period].start,u=options.periods[options.period].end,e=options.period<20?"days":"months",o=options.period<20?f=="ru-RU"?"d MMM":"MMM dd":"MMM, yyyy",h=options.view=="all"?"":options.owner==="all"?t.advertisers:t.advertiser+": "+options.owner,c=options.samProAjax+(options.view=="sold"?"sam-pro-ajax-admin.php?action=load_chart_data":"sam-pro-ajax-admin.php?action=load_chart_data_all")+"&wap="+i,l=options.samProAjax+(options.view=="sold"?"sam-pro-ajax-admin.php?action=load_grid_data":"sam-pro-ajax-admin.php?action=load_grid_data_all")+"&wap="+i,a=options.samProAjax+(options.view=="sold"?"sam-pro-ajax-admin.php?action=load_grid_child_data&start="+r+"&end="+u+"&owner="+options.owner+"&period="+options.period:"sam-pro-ajax-admin.php?action=load_grid_child_data_all&start="+r+"&end="+u+"&owner="+options.owner+"&period="+options.period)+"&wap="+i,v=options.samProAjax+(options.view=="sold"?"sam-pro-ajax-admin.php?action=load_pie_data":"sam-pro-ajax-admin.php?action=load_pie_data_all")+"&wap="+i,y=options.samProAjax+(options.view=="sold"?"sam-pro-ajax-admin.php?action=load_pie_data_2":"sam-pro-ajax-admin.php?action=load_pie_data_2_all")+"&wap="+i,s="&item="+options.item+"&start="+r+"&end="+u+"&period="+options.period+"&owner="+options.owner;n(document).ready(function(){function k(s,h){var l=options.samProAjax+"sam-pro-ajax-admin.php?action=load_ad_chart_data&wap="+i,a="&aid="+s+"&pid="+h+"&start="+r+"&end="+u+"&period="+options.period,c=ej.DataManager({url:l+a,requestType:"json",adaptor:new ej.UrlAdaptor}),v=new ej.Query,y=c.executeQuery(v);return y.done(function(i){var r=n("#ad-chart").ejChart({locale:f,enableCanvasRendering:!0,canResize:!0,isResponsive:!0,theme:ej.datavisualization.Chart.Theme.FlatLight,title:{text:options.periods[options.period].title,font:{fontFamily:'"Open Sans",sans-serif',fontWeight:"bold"}},primaryXAxis:{valueType:"datetime",intervalType:e,labelFormat:o},commonSeriesOptions:{tooltip:{visible:!0,format:"#series.name#: #point.y#"}},series:[{name:t.impressions,type:"column",dataSource:c,xName:"mdate",yName:"hits",query:i.query,marker:{dataLabel:{visible:!0,textPosition:"top",fill:"#FF7777",verticalTextAlignment:"top",offset:20,shape:"rectangle",font:{color:"white"}}}},{name:t.clicks,type:"column",dataSource:c,xName:"mdate",yName:"clicks",query:i.query,marker:{dataLabel:{visible:!0,textPosition:"top",fill:"#ffd45a",verticalTextAlignment:"top",offset:20,shape:"rectangle",font:{color:"white"}}}}]}).data("ejChart");r.redraw()}),!1}var p=n("#chart-dialog").ejDialog({width:950,allowDraggable:!0,enableModal:!0,showOnInit:!1}).data("ejDialog");n("#close-chart").on("click",function(n){n.preventDefault();p.close()});var w=ej.DataManager({url:c,requestType:"json",adaptor:new ej.UrlAdaptor}),b=(new ej.Query).addParams("item",options.item).addParams("start",r).addParams("end",u).addParams("owner",options.owner).addParams("period",options.period),ut=n("#chart").ejChart({locale:f,enableCanvasRendering:!0,canResize:!0,isResponsive:!0,theme:ej.datavisualization.Chart.Theme.FlatLight,title:{text:options.periods[options.period].title,font:{fontFamily:'"Open Sans",sans-serif',fontWeight:"bold"},subTitle:{text:h,font:{size:"14px",fontFamily:'"Open Sans",sans-serif',fontWeight:"bold"}}},primaryXAxis:{valueType:"datetime",intervalType:e,labelFormat:o},commonSeriesOptions:{tooltip:{visible:!0,format:"#series.name#: #point.y#"}},series:[{name:t.impressions,type:"column",dataSource:w,xName:"mdate",yName:"hits",query:b,enableSmartLabels:!0,marker:{dataLabel:{visible:!0,textPosition:"top",fill:"#FF7777",verticalTextAlignment:"top",offset:10,shape:"rectangle",font:{color:"white"}}}},{name:t.clicks,type:"column",dataSource:w,xName:"mdate",yName:"clicks",query:b,marker:{dataLabel:{visible:!0,textPosition:"top",fill:"#ffd45a",verticalTextAlignment:"top",offset:20,shape:"rectangle",font:{color:"white"}}}}]}),d=ej.DataManager({url:l,requestType:"json",adaptor:new ej.UrlAdaptor}),g=ej.DataManager({url:a,requestType:"json",adaptor:new ej.UrlAdaptor}),nt=options.view=="sold"?[{field:"pid",headerText:t.adId,isPrimaryKey:!0,textAlign:ej.TextAlign.Right,width:70},{field:"title",headerText:t.name},{field:"hits",headerText:t.impressions,textAlign:ej.TextAlign.Right,width:100},{field:"clicks",headerText:t.clicks,textAlign:ej.TextAlign.Right,width:80},{field:"income",headerText:t.income,textAlign:ej.TextAlign.Right,width:100},{field:"cpm",headerText:"CPM",textAlign:ej.TextAlign.Right,width:100},{field:"cpc",headerText:"CPC",textAlign:ej.TextAlign.Right,width:100},{field:"ctr",headerText:"CTR",textAlign:ej.TextAlign.Right,width:100}]:[{field:"pid",headerText:t.adId,isPrimaryKey:!0,textAlign:ej.TextAlign.Right,width:70},{field:"title",headerText:t.name},{field:"hits",headerText:t.impressions,textAlign:ej.TextAlign.Right,width:100},{field:"clicks",headerText:t.clicks,textAlign:ej.TextAlign.Right,width:80},{field:"sold",headerText:t.status,textAlign:ej.TextAlign.Center,width:100}],tt=options.view=="sold"?[{field:"pid",headerText:"Place ID",isPrimaryKey:!0,visible:!1},{field:"aid",headerText:t.adId,textAlign:ej.TextAlign.Right,width:70},{field:"title",headerText:t.name},{field:"hits",headerText:t.impressions,textAlign:ej.TextAlign.Right,width:100},{field:"clicks",headerText:t.clicks,textAlign:ej.TextAlign.Right,width:80},{field:"income",headerText:t.income,textAlign:ej.TextAlign.Right,width:100},{field:"cpm",headerText:"CPM",textAlign:ej.TextAlign.Right,width:100},{field:"cpc",headerText:"CPC",textAlign:ej.TextAlign.Right,width:100},{field:"ctr",headerText:"CTR",textAlign:ej.TextAlign.Right,width:100}]:[{field:"pid",headerText:"Place ID",isPrimaryKey:!0,visible:!1},{field:"aid",headerText:t.adId,textAlign:ej.TextAlign.Right,width:70},{field:"title",headerText:t.name},{field:"hits",headerText:t.impressions,textAlign:ej.TextAlign.Right,width:100},{field:"clicks",headerText:t.clicks,textAlign:ej.TextAlign.Right,width:80}],ft=n("#grid").ejGrid({dataSource:d,query:(new ej.Query).addParams("item",options.item).addParams("start",r).addParams("end",u).addParams("owner",options.owner).addParams("period",options.period),locale:f,allowTextWrap:!0,allowPaging:!0,pageSettings:{pageSize:options.itemsPerPage},allowSelection:!0,selectionType:ej.Grid.SelectionType.Single,selectionSettings:{selectionMode:[ej.Grid.SelectionMode.Row],enableToggle:!0},columns:nt,childGrid:{dataSource:g,queryString:"pid",locale:f,allowTextWrap:!0,allowSelection:!0,selectionType:ej.Grid.SelectionType.Single,selectionSettings:{selectionMode:[ej.Grid.SelectionMode.Row],enableToggle:!0},toolbarSettings:{showToolbar:!0,customToolbarItems:["Ad_Chart"]},columns:tt,actionComplete:function(t){if(t.requestType=="refresh"){var i=n("#"+this._id+"_toolbarItems"),r=n("#"+this._id+"_Ad_Chart");i.ejToolbar("disableItem",r)}},toolbarClick:function(t){var r=n(t.target),i=this.getSelectedRecords(),u=i[0].pid,f=i[0].aid,e;r.hasClass("Ad_Chart")&&(e=k(f,u),p.open())},recordClick:function(){var t=n("#"+this._id+"_toolbarItems"),i=n("#"+this._id+"_Ad_Chart"),r=this.getSelectedRecords(),u=r.length==0?"disableItem":"enableItem";t.ejToolbar(u,i)},create:function(){n(".Ad_Chart").parent("li").attr("title",t.statistics)}}}).data("ejGrid"),it=ej.DataManager({url:v+s,requestType:"json",adaptor:new ej.UrlAdaptor}),rt=ej.DataManager({url:y+s,requestType:"json",adaptor:new ej.UrlAdaptor}),et=n("#pieChartHits").ejChart({title:{text:t.impressions,font:{fontFamily:'"Open Sans",sans-serif',fontWeight:"bold",size:"20px"}},series:[{dataSource:it,query:new ej.Query,xName:"title",yName:"hits",type:"doughnut",tooltip:{format:"#point.x# : #point.y#",visible:!0},labelPosition:"outside",doughnutCoefficient:.4,marker:{dataLabel:{visible:!0,connectorLine:{height:20},font:{size:"13px"}}}}],isResponsive:!0,legend:{visible:!0}}),ot=n("#pieChartClicks").ejChart({title:{text:t.clicks,font:{fontFamily:'"Open Sans",sans-serif',fontWeight:"bold",size:"20px"}},series:[{dataSource:rt,query:new ej.Query,tooltip:{format:"#point.x# : #point.y#",visible:!0},xName:"title",yName:"clicks",type:"doughnut",marker:{dataLabel:{visible:!0,connectorLine:{height:20},font:{size:"13px"}}},labelPosition:"outside"}],isResponsive:!0,legend:{visible:!0}})})})(jQuery)