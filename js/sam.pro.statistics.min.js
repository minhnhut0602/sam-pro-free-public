(function(n){var u=options.locale.changeLocale?options.locale.locale:"en-US",t=options.strings,y=options.wap,i=options.periods[options.period].start,r=options.periods[options.period].end,f=options.period<20?"days":"months",e=options.period<20?u=="ru-RU"?"d MMM":"MMM dd":"MMM, yyyy",s=options.view=="all"?"":options.owner==="all"?t.advertisers:t.advertiser+": "+options.owner,h=ajaxurl+(options.view=="sold"?"?action=load_chart_data":"?action=load_chart_data_all")+"&sam_pro_nonce="+options.samProNonce,c=ajaxurl+(options.view=="sold"?"?action=load_grid_data":"?action=load_grid_data_all")+"&sam_pro_nonce="+options.samProNonce,l=ajaxurl+(options.view=="sold"?"?action=load_grid_child_data&start="+i+"&end="+r+"&owner="+options.owner+"&period="+options.period:"?action=load_grid_child_data_all&start="+i+"&end="+r+"&owner="+options.owner+"&period="+options.period)+"&sam_pro_nonce="+options.samProNonce,a=ajaxurl+(options.view=="sold"?"?action=load_pie_data":"?action=load_pie_data_all")+"&sam_pro_nonce="+options.samProNonce,v=ajaxurl+(options.view=="sold"?"?action=load_pie_data_2":"?action=load_pie_data_2_all")+"&sam_pro_nonce="+options.samProNonce,o="&item="+options.item+"&start="+i+"&end="+r+"&period="+options.period+"&owner="+options.owner;n(document).ready(function(){function b(o,s){var c=ajaxurl+"?action=load_ad_chart_data&sam_pro_nonce="+options.samProNonce,l="&aid="+o+"&pid="+s+"&start="+i+"&end="+r+"&period="+options.period,h=ej.DataManager({url:c+l,requestType:"json",adaptor:new ej.UrlAdaptor}),a=new ej.Query,v=h.executeQuery(a);return v.done(function(i){var r=n("#ad-chart").ejChart({locale:u,enableCanvasRendering:!0,canResize:!0,isResponsive:!0,theme:ej.datavisualization.Chart.Theme.FlatLight,title:{text:options.periods[options.period].title,font:{fontFamily:'"Open Sans",sans-serif',fontWeight:"bold"}},primaryXAxis:{valueType:"datetime",intervalType:f,labelFormat:e},commonSeriesOptions:{tooltip:{visible:!0,format:"#series.name#: #point.y#"}},series:[{name:t.impressions,type:"column",dataSource:h,xName:"mdate",yName:"hits",query:i.query,marker:{dataLabel:{visible:!0,textPosition:"top",fill:"#FF7777",verticalTextAlignment:"top",offset:20,shape:"rectangle",font:{color:"white"}}}},{name:t.clicks,type:"column",dataSource:h,xName:"mdate",yName:"clicks",query:i.query,marker:{dataLabel:{visible:!0,textPosition:"top",fill:"#ffd45a",verticalTextAlignment:"top",offset:20,shape:"rectangle",font:{color:"white"}}}}]}).data("ejChart");r.redraw()}),!1}var y=n("#chart-dialog").ejDialog({width:950,allowDraggable:!0,enableModal:!0,showOnInit:!1}).data("ejDialog");n("#close-chart").on("click",function(n){n.preventDefault();y.close()});var p=ej.DataManager({url:h,requestType:"json",adaptor:new ej.UrlAdaptor}),w=(new ej.Query).addParams("item",options.item).addParams("start",i).addParams("end",r).addParams("owner",options.owner).addParams("period",options.period),rt=n("#chart").ejChart({locale:u,enableCanvasRendering:!0,canResize:!0,isResponsive:!0,theme:ej.datavisualization.Chart.Theme.FlatLight,title:{text:options.periods[options.period].title,font:{fontFamily:'"Open Sans",sans-serif',fontWeight:"bold"},subTitle:{text:s,font:{size:"14px",fontFamily:'"Open Sans",sans-serif',fontWeight:"bold"}}},primaryXAxis:{valueType:"datetime",intervalType:f,labelFormat:e},commonSeriesOptions:{tooltip:{visible:!0,format:"#series.name#: #point.y#"}},series:[{name:t.impressions,type:"column",dataSource:p,xName:"mdate",yName:"hits",query:w,enableSmartLabels:!0,marker:{dataLabel:{visible:!0,textPosition:"top",fill:"#FF7777",verticalTextAlignment:"top",offset:10,shape:"rectangle",font:{color:"white"}}}},{name:t.clicks,type:"column",dataSource:p,xName:"mdate",yName:"clicks",query:w,marker:{dataLabel:{visible:!0,textPosition:"top",fill:"#ffd45a",verticalTextAlignment:"top",offset:20,shape:"rectangle",font:{color:"white"}}}}]}),k=ej.DataManager({url:c,requestType:"json",adaptor:new ej.UrlAdaptor}),d=ej.DataManager({url:l,requestType:"json",adaptor:new ej.UrlAdaptor}),g=options.view=="sold"?[{field:"pid",headerText:t.adId,isPrimaryKey:!0,textAlign:ej.TextAlign.Right,width:70},{field:"title",headerText:t.name},{field:"hits",headerText:t.impressions,textAlign:ej.TextAlign.Right,width:100},{field:"clicks",headerText:t.clicks,textAlign:ej.TextAlign.Right,width:80},{field:"income",headerText:t.income,textAlign:ej.TextAlign.Right,width:100},{field:"cpm",headerText:"CPM",textAlign:ej.TextAlign.Right,width:100},{field:"cpc",headerText:"CPC",textAlign:ej.TextAlign.Right,width:100},{field:"ctr",headerText:"CTR",textAlign:ej.TextAlign.Right,width:100}]:[{field:"pid",headerText:t.adId,isPrimaryKey:!0,textAlign:ej.TextAlign.Right,width:70},{field:"title",headerText:t.name},{field:"hits",headerText:t.impressions,textAlign:ej.TextAlign.Right,width:100},{field:"clicks",headerText:t.clicks,textAlign:ej.TextAlign.Right,width:80},{field:"sold",headerText:t.status,textAlign:ej.TextAlign.Center,width:100}],nt=options.view=="sold"?[{field:"pid",headerText:"Place ID",isPrimaryKey:!0,visible:!1},{field:"aid",headerText:t.adId,textAlign:ej.TextAlign.Right,width:70},{field:"title",headerText:t.name},{field:"hits",headerText:t.impressions,textAlign:ej.TextAlign.Right,width:100},{field:"clicks",headerText:t.clicks,textAlign:ej.TextAlign.Right,width:80},{field:"income",headerText:t.income,textAlign:ej.TextAlign.Right,width:100},{field:"cpm",headerText:"CPM",textAlign:ej.TextAlign.Right,width:100},{field:"cpc",headerText:"CPC",textAlign:ej.TextAlign.Right,width:100},{field:"ctr",headerText:"CTR",textAlign:ej.TextAlign.Right,width:100}]:[{field:"pid",headerText:"Place ID",isPrimaryKey:!0,visible:!1},{field:"aid",headerText:t.adId,textAlign:ej.TextAlign.Right,width:70},{field:"title",headerText:t.name},{field:"hits",headerText:t.impressions,textAlign:ej.TextAlign.Right,width:100},{field:"clicks",headerText:t.clicks,textAlign:ej.TextAlign.Right,width:80}],ut=n("#grid").ejGrid({dataSource:k,query:(new ej.Query).addParams("item",options.item).addParams("start",i).addParams("end",r).addParams("owner",options.owner).addParams("period",options.period),locale:u,allowTextWrap:!0,allowPaging:!0,pageSettings:{pageSize:options.itemsPerPage},allowSelection:!0,selectionType:ej.Grid.SelectionType.Single,selectionSettings:{selectionMode:[ej.Grid.SelectionMode.Row],enableToggle:!0},columns:g,childGrid:{dataSource:d,queryString:"pid",locale:u,allowTextWrap:!0,allowSelection:!0,selectionType:ej.Grid.SelectionType.Single,selectionSettings:{selectionMode:[ej.Grid.SelectionMode.Row],enableToggle:!0},toolbarSettings:{showToolbar:!0,customToolbarItems:["Ad_Chart"]},columns:nt,actionComplete:function(t){if(t.requestType=="refresh"){var i=n("#"+this._id+"_toolbarItems"),r=n("#"+this._id+"_Ad_Chart");i.ejToolbar("disableItem",r)}},toolbarClick:function(t){var r=n(t.target),i=this.getSelectedRecords(),u=i[0].pid,f=i[0].aid,e;r.hasClass("Ad_Chart")&&(e=b(f,u),y.open())},recordClick:function(){var t=n("#"+this._id+"_toolbarItems"),i=n("#"+this._id+"_Ad_Chart"),r=this.getSelectedRecords(),u=r.length==0?"disableItem":"enableItem";t.ejToolbar(u,i)},create:function(){n(".Ad_Chart").parent("li").attr("title",t.statistics)}}}).data("ejGrid"),tt=ej.DataManager({url:a+o,requestType:"json",adaptor:new ej.UrlAdaptor}),it=ej.DataManager({url:v+o,requestType:"json",adaptor:new ej.UrlAdaptor}),ft=n("#pieChartHits").ejChart({title:{text:t.impressions,font:{fontFamily:'"Open Sans",sans-serif',fontWeight:"bold",size:"20px"}},series:[{dataSource:tt,query:new ej.Query,xName:"title",yName:"hits",type:"doughnut",tooltip:{format:"#point.x# : #point.y#",visible:!0},labelPosition:"outside",doughnutCoefficient:.4,marker:{dataLabel:{visible:!0,connectorLine:{height:20},font:{size:"13px"}}}}],isResponsive:!0,legend:{visible:!0}}),et=n("#pieChartClicks").ejChart({title:{text:t.clicks,font:{fontFamily:'"Open Sans",sans-serif',fontWeight:"bold",size:"20px"}},series:[{dataSource:it,query:new ej.Query,tooltip:{format:"#point.x# : #point.y#",visible:!0},xName:"title",yName:"clicks",type:"doughnut",marker:{dataLabel:{visible:!0,connectorLine:{height:20},font:{size:"13px"}}},labelPosition:"outside"}],isResponsive:!0,legend:{visible:!0}})})})(jQuery)