var sam=sam||{};(function(n){var i,f=options.media,r=parseInt(options.item,10),u=options.locale.changeLocale?options.locale.locale:"en-US",t=options.strings,e=options.wap;sam.media=i={};sam.media=i={buttonId:"#banner-media",adUrl:"#img",adImgId:"#img_id",adName:"#title",adDesc:"#description",adAlt:"#alt",init:function(){n(this.buttonId).on("click",this.openMediaDialog)},openMediaDialog:function(n){if(n.preventDefault(),this._frame){this._frame.open();return}this._frame=i.frame=wp.media({title:f.title,button:{text:f.button},multiple:!1,library:{type:"image"}});this._frame.state("library").on("select",function(){var n=this.get("selection").single();i.handleMediaAttachment(n)});this._frame.open()},handleMediaAttachment:function(t){var i=t.toJSON();n(this.adUrl).val(i.url);n(this.adImgId).val(i.id);""==n(this.adName).val()&&""!=i.title&&n(this.adName).val(i.title);""==n(this.adDesc).val()&&""!=i.caption&&n(this.adDesc).val(i.caption);""==n(this.adAlt).val()&&""!=i.alt&&n(this.adAlt).val(i.alt)}};n(document).ready(function(){n("#tabs").ejTab({enablePersistence:!0});i.init();var e=n("#rc-ami"),o=n("#rc-amc"),s=n("#rc-amd");n("input:radio[name=amode]").on("click",function(){var t=n("input:radio[name=amode]:checked").val();t==0?(e.is(":hidden")&&e.show("blind",{direction:"vertical"},500),o.is(":visible")&&o.hide("blind",{direction:"vertical"},500),s.is(":visible")&&s.hide("blind",{direction:"vertical"},500)):t==1?(o.is(":hidden")&&o.show("blind",{direction:"vertical"},500),e.is(":visible")&&e.hide("blind",{direction:"vertical"},500),s.is(":visible")&&s.hide("blind",{direction:"vertical"},500)):t==2&&(s.is(":hidden")&&s.show("blind",{direction:"vertical"},500),o.is(":visible")&&o.hide("blind",{direction:"vertical"},500),e.is(":visible")&&e.hide("blind",{direction:"vertical"},500))});var y=n("#rc-sale"),p=n("#sale"),h=n("#rc-sale-mode");p.on("click",function(){p.is(":checked")?y.show("blind",{direction:"vertical"},500):y.hide("blind",{direction:"vertical"},500)});n("input:radio[name=sale_mode]").on("click",function(){var t=n("input:radio[name=sale_mode]:checked").val();t==0?h.is(":hidden")&&h.show("blind",{direction:"vertical"},500):h.is(":visible")&&h.hide("blind",{direction:"vertical"},500)});var c=n("#code_before"),l=n("#code_after"),w=n("#width").val()+"px";n("#sam-pro-center").on("click",function(n){n.preventDefault();c.val("<div style='text-align:center'>");l.val("<\/div>")});n("#sam-pro-left").on("click",function(n){n.preventDefault();c.val("<div style='float: left; width: "+w+";'>");l.val("<\/div>")});n("#sam-pro-right").on("click",function(n){n.preventDefault();c.val("<div style='float: right; width: "+w+";'>");l.val("<\/div>")});var b=n("#sdate"),k=n("#fdate"),it=n("#startDate").ejDateTimePicker({width:250,locale:u,buttonText:options.buttonText,dateTimeFormat:"yyyy-MM-dd HH:mm:ss",timeDisplayFormat:"HH:mm:ss",value:b.val(),change:function(n){b.val(n.value)}}).data("ejDateTimePicker"),rt=n("#finishDate").ejDateTimePicker({width:250,locale:u,buttonText:options.buttonText,dateTimeFormat:"yyyy-MM-dd HH:mm:ss",timeDisplayFormat:"HH:mm:ss",value:k.val(),change:function(n){k.val(n.value)}}).data("ejDateTimePicker");if(r>0){var d,a,v=n("#adsDialog").ejDialog({width:830,allowDraggable:!0,enableModal:!0,showOnInit:!1}).data("ejDialog"),f=new Selectors,g=ej.DataManager({url:ajaxurl+"?action=load_places_ads_item&pid="+r+"&sam_pro_nonce="+options.samProNonce,removeUrl:ajaxurl+"?action=unlink_ad_item&pid="+r+"&sam_pro_nonce="+options.samProNonce,updateUrl:ajaxurl+"?action=update_place_ad&sam_pro_nonce="+options.samProNonce,requestType:"json",adaptor:new ej.UrlAdaptor}),nt=n("#grid").ejGrid({dataSource:g,locale:u,allowSorting:!0,allowPaging:!0,pageSettings:{pageSize:options.itemsPerPage},allowSelection:!0,selectionSettings:{selectionMode:[ej.Grid.SelectionMode.Row],enableToggle:!0},editSettings:{allowEditing:!0,allowDeleting:!0,showDeleteConfirmDialog:!0},toolbarSettings:{showToolbar:!0,toolbarItems:["edit",ej.Grid.ToolBarItems.Update,ej.Grid.ToolBarItems.Cancel,ej.Grid.ToolBarItems.Delete],customToolbarItems:["Link","Edit_Ad","Refresh"]},columns:[{field:"pid",headerText:"Place ID",visible:!1},{field:"aid",headerText:t.adId,isPrimaryKey:!0,allowEditing:!1,textAlign:ej.TextAlign.Right,width:90},{field:"title",headerText:t.name,allowEditing:!1,width:180},{field:"description",headerText:t.desc,allowEditing:!1},{field:"weight",headerText:t.weight,textAlign:ej.TextAlign.Right,allowEditing:!0,editType:ej.Grid.EditingType.Numeric,defaultValue:10,validationRules:{range:[0,10]},width:100},{field:"trash",headerText:t.status,allowEditing:!1,textAlign:ej.TextAlign.Center,width:100}],create:function(){n(".Link").parent("li").attr("title",t.linkAds);n("#grid_delete").attr("title",t.unlinkAd);n(".Refresh").parent("li").attr("title",t.refresh);n(".Edit_Ad").parent("li").attr("title",t.editAd)},toolbarClick:function(t){var i=n(t.target),r=this.getSelectedRecords(),u;i.hasClass("Refresh")?this.refreshContent():i.hasClass("Link")?tt():i.hasClass("Edit_Ad")&&r.length>0&&(u=r[0].aid,document.location=options.adEditorUrl+u)},actionComplete:function(){var i=n("#grid_toolbarItems"),t;t=n("#grid_delete");i.ejToolbar("disableItem",t);t=n("#grid_Edit_Ad");i.ejToolbar("disableItem",t)},recordClick:function(){var i=n("#grid_toolbarItems"),t,u=this.getSelectedRecords(),r=u.length==0?"disableItem":"enableItem";t=n("#grid_delete");i.ejToolbar(r,t);t=n("#grid_Edit_Ad");i.ejToolbar(r,t)}}).data("ejGrid");function tt(){d=ej.DataManager({url:ajaxurl+"?action=list_ads&pid="+r+"&sam_pro_nonce="+options.samProNonce,requestType:"json",adaptor:new ej.UrlAdaptor});a=n("#adsGrid").ejGrid({dataSource:d,locale:u,allowTextWrap:!0,allowPaging:!0,pageSettings:{pageSize:options.itemsPerPage},allowSorting:!0,allowSelection:!0,selectionType:ej.Grid.SelectionType.Multiple,selectionSettings:{selectionMode:[ej.Grid.SelectionMode.Row],enableToggle:!0},columns:[{field:"aid",headerText:t.adId,isPrimaryKey:!0,textAlign:ej.TextAlign.Right,width:120},{field:"title",headerText:t.name,width:280},{field:"description",headerText:t.desc,width:400}],rowSelected:function(n){if(!f.service){f.page=n.model.pageSettings.currentPage;var t=f.pids[f.page].slice(0),i=t.indexOf(n.data.aid);i>-1?f.removePid(n.data.aid):f.pids=n.data.aid}},actionComplete:function(n){var t,i,r=f.ids.slice(0);if(f.service=!0,r.length!=0)for(t=0;t<this.model.currentViewData.length;t++)for(i=0;i<r.length;i++)r[i]==this.model.currentViewData[t].aid&&(this.multiSelectCtrlRequest=!0,this.selectRows(t),n.requestType=="paging"?(f.page=n.currentPage,f.pids=this.model.currentViewData[t].aid):n.requestType=="refresh"&&(f.page=1,f.pids=this.model.currentViewData[t].aid));f.service=!1}}).data("ejGrid");f.sid="";v.open()}n("#cancel-ads").on("click",function(){v.close();a.destroy()});n("#select-ads").on("click",function(){var t=f.sid;t!=""&&n.post(ajaxurl+"?action=link_ads",{pid:r,sid:t,sam_pro_nonce:options.samProNonce}).done(function(){nt.refreshContent()});v.close();a.destroy()})}})})(jQuery)