(function(n){var r=options.locale.changeLocale?options.locale.locale:"en-US",t=options.strings,i=options.wap;n(document).ready(function(){var f,e=ej.DataManager({url:ajaxurl+"?action=load_blocks&wap="+i+"&sam_pro_nonce="+options.samProNonce,removeUrl:ajaxurl+"?action=remove_block&wap="+i+"&sam_pro_nonce="+options.samProNonce,requestType:"json",adaptor:new ej.UrlAdaptor}),u=n("#grid").ejGrid({dataSource:e,locale:r,allowTextWrap:!0,allowPaging:!0,allowSorting:!0,allowFiltering:!0,filterSettings:{filterType:"menu"},pageSettings:{pageSize:options.itemsPerPage},allowSelection:!0,selectionSettings:{selectionMode:[ej.Grid.SelectionMode.Row],enableToggle:!0},editSettings:{allowDeleting:!0,showDeleteConfirmDialog:!0},toolbarSettings:{showToolbar:!0,toolbarItems:[ej.Grid.ToolBarItems.Delete],customToolbarItems:[{templateID:"#viewMode"},"Refresh",{templateID:"#NewBlock"},"Edit",{templateID:"#TrashBlock"},{templateID:"#UnTrashBlock"}]},toolbarClick:function(t){var r=n(t.target),e=this.getSelectedRecords(),h,c,s,l;r.hasClass("Refresh")&&this.refreshContent();r.hasClass("Edit")?e.length>0&&(c=e[0].bid,document.location=options.editorUrl+c):(r.hasClass("block-to-trash")||r.hasClass("block-from-trash"))&&(s=r.hasClass("block-to-trash")?1:0,e.length>0&&(l=parseInt(e[0].trash,10),h=parseInt(e[0].bid,10),l!=s&&n.post(ajaxurl,{action:"trash_block",bid:h,trash:s,sam_pro_nonce:options.samProNonce,wap:i}).done(function(){var n=parseInt(o.getSelectedValue(),10);n==0?u._disabledToolItems.push(f[6]):n==1&&u._disabledToolItems.push(f[5]);u.refreshContent()})))},create:function(){var i=n("#grid_toolbarItems");f=i.find("li");n(".block-to-trash").parent("li").attr("title",t.moveToTrash);n(".block-from-trash").parent("li").attr("title",t.restoreFromTrash);n('li[title="viewMode"]').attr("title",t.viewMode);n('li[title="NewBlock"]').attr("title",t.newBlock);n('li[title="Edit"]').attr("title",t.edit);n(".Refresh").parent("li").attr("title",t.refresh)},actionComplete:function(){var i=n("#grid_toolbarItems"),t;t=n("#grid_delete");i.ejToolbar("disableItem",t);t=n("#grid_Edit");i.ejToolbar("disableItem",t);t=n("#grid_TrashBlock");i.ejToolbar("disableItem",t);t=n("#grid_UnTrashBlock");i.ejToolbar("disableItem",t)},recordClick:function(){var i=n("#grid_toolbarItems"),t,u=this.getSelectedRecords(),r=u.length==0?"disableItem":"enableItem";t=n("#grid_delete");i.ejToolbar(r,t);t=n("#grid_Edit");i.ejToolbar(r,t);t=n("#grid_TrashBlock");i.ejToolbar(r,t);t=n("#grid_UnTrashBlock");i.ejToolbar(r,t)},columns:[{field:"bid",headerText:t.bid,isPrimaryKey:!0,textAlign:ej.TextAlign.Right,allowSorting:!0,allowEditing:!1,width:100},{field:"title",headerText:t.name,allowSorting:!0,allowEditing:!1,width:250},{field:"description",headerText:t.desc,allowSorting:!0,allowEditing:!1},{field:"size",headerText:t.size,textAlign:ej.TextAlign.Center,width:100},{field:"stat",headerText:t.status,textAlign:ej.TextAlign.Center,allowSorting:!1,allowEditing:!1,allowFiltering:!1,width:100},{field:"trash",headerText:"Status",allowEditing:!1,visible:!1}]}).data("ejGrid"),o=n("#view-mode").ejDropDownList({selectedItemIndex:0,change:function(){var t=parseInt(this.getSelectedValue(),10);t!=10?n("#grid").ejGrid("model.query",(new ej.Query).where("trash",ej.FilterOperators.equal,t,10)):n("#grid").ejGrid("model.query",new ej.Query);t==0?u._disabledToolItems.push(f[6]):t==1&&u._disabledToolItems.push(f[5]);u.refreshContent(!0)}}).data("ejDropDownList")})})(jQuery)