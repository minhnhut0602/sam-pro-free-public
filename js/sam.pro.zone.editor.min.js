var zoneRules=options.rules.rules,singleRules=options.rules.single,item=options.item,places=options.places,pageSize=options.itemsPerPage;(function(n){var i=options.locale.changeLocale?options.locale.locale:"en-US",t=options.strings;n(document).ready(function(){var o,s,f=n("#rulesDialog").ejDialog({width:830,allowDraggable:!0,enableModal:!0,showOnInit:!1}).data("ejDialog"),e=n("#singleDialog").ejDialog({width:830,allowDraggable:!0,enableModal:!0,showOnInit:!1}).data("ejDialog"),r=new Selectors,u=new Selectors;r.sid="";u.sid="";o=n("#rulesGrid").ejGrid({dataSource:zoneRules,locale:i,allowSorting:!0,allowSelection:!0,selectionType:ej.Grid.SelectionType.Multiple,selectionSettings:{selectionMode:[ej.Grid.SelectionMode.Row],enableToggle:!0},allowPaging:!0,pageSettings:{pageSize:pageSize},columns:[{field:"slug",visible:!1},{field:"tax",headerText:t.type},{field:"name",headerText:t.name},{field:"term_slug",visible:!1},{field:"priority",visible:!1}],rowSelected:function(n){if(!r.service){r.page=n.model.pageSettings.currentPage;var t=r.pids[r.page].slice(0),i=t.indexOf(n.data.slug);i>-1?r.removePid(n.data.slug):r.pids=n.data.slug}},actionComplete:function(n){var t,i,u=r.ids.slice(0);if(r.service=!0,u.length!=0)for(t=0;t<this.model.currentViewData.length;t++)for(i=0;i<u.length;i++)u[i]==this.model.currentViewData[t].slug&&(this.multiSelectCtrlRequest=!0,this.selectRows(t),n.requestType=="paging"?(r.page=n.currentPage,r.pids=this.model.currentViewData[t].slug):n.requestType=="refresh"&&(r.page=1,r.pids=this.model.currentViewData[t].slug));r.service=!1}}).data("ejGrid");s=n("#singleGrid").ejGrid({dataSource:singleRules,locale:i,allowSorting:!0,allowSelection:!0,selectionType:ej.Grid.SelectionType.Multiple,selectionSettings:{selectionMode:[ej.Grid.SelectionMode.Row],enableToggle:!0},allowPaging:!0,pageSettings:{pageSize:pageSize},columns:[{field:"slug",visible:!1},{field:"tax",headerText:t.type},{field:"name",headerText:t.name},{field:"term_slug",visible:!1},{field:"priority",visible:!1}],rowSelected:function(n){if(!u.service){u.page=n.model.pageSettings.currentPage;var t=u.pids[u.page].slice(0),i=t.indexOf(n.data.slug);i>-1?u.removePid(n.data.slug):u.pids=n.data.slug}},actionComplete:function(n){var t,i,r=u.ids.slice(0);if(u.service=!0,r.length!=0)for(t=0;t<this.model.currentViewData.length;t++)for(i=0;i<r.length;i++)r[i]==this.model.currentViewData[t].slug&&(this.multiSelectCtrlRequest=!0,this.selectRows(t),n.requestType=="paging"?(u.page=n.currentPage,u.pids=this.model.currentViewData[t].slug):n.requestType=="refresh"&&(u.page=1,u.pids=this.model.currentViewData[t].slug));u.service=!1}}).data("ejGrid");n("#cancel-rules").on("click",function(){f.close()});n("#select-rules").on("click",function(t){t.preventDefault();for(var o=r.sid,e=o.split(","),u=[],i=0;i<e.length;i++)u.push(zoneRules.find(function(n){return n.slug==e[i]}));u.length>0&&n.post(ajaxurl,{action:"add_zone_rules",zid:item,rules:u,sam_pro_nonce:options.samProNonce}).done(function(){l.refreshContent()});f.close()});n("#cancel-single").on("click",function(){e.close()});n("#select-single").on("click",function(t){t.preventDefault();for(var o=u.sid,f=o.split(","),r=[],i=0;i<f.length;i++)r.push(singleRules.find(function(n){return n.slug==f[i]}));r.length>0&&n.post(ajaxurl,{action:"add_zone_single_rules",zid:item,rules:r,sam_pro_nonce:options.samProNonce}).done(function(){a.refreshContent()});e.close()});var h=ej.DataManager({url:ajaxurl+"?action=load_zone_rules&item="+item+"&sam_pro_nonce="+options.samProNonce,updateUrl:ajaxurl+"?action=update_zone_rule&item="+item+"&sam_pro_nonce="+options.samProNonce,removeUrl:ajaxurl+"?action=remove_zone_rule&item="+item+"&sam_pro_nonce="+options.samProNonce,requestType:"json",adaptor:new ej.UrlAdaptor}),c=ej.DataManager({url:ajaxurl+"?action=load_zone_single_rules&item="+item+"&sam_pro_nonce="+options.samProNonce,updateUrl:ajaxurl+"?action=update_zone_single_rule&item="+item+"&sam_pro_nonce="+options.samProNonce,removeUrl:ajaxurl+"?action=remove_zone_single_rule&item="+item+"&sam_pro_nonce="+options.samProNonce,requestType:"json",adaptor:new ej.UrlAdaptor}),l=n("#aGrid").ejGrid({dataSource:h,locale:i,allowSorting:!0,allowSelection:!0,selectionType:ej.Grid.SelectionType.Single,selectionSettings:{selectionMode:[ej.Grid.SelectionMode.Row],enableToggle:!0},allowPaging:!0,pageSettings:{pageSize:pageSize},editSettings:{allowEditing:!0,allowDeleting:!0,showDeleteConfirmDialog:!0},toolbarSettings:{showToolbar:!0,toolbarItems:[ej.Grid.ToolBarItems.Edit,ej.Grid.ToolBarItems.Update,ej.Grid.ToolBarItems.Cancel,ej.Grid.ToolBarItems.Delete],customToolbarItems:["Refresh","Add"]},toolbarClick:function(t){var i=n(t.target);i.hasClass("Refresh")?this.refreshContent():i.hasClass("Add")&&f.open()},create:function(){n(".Refresh").parent("li").attr("title",t.refresh);n(".Add").parent("li").attr("title",t.add)},actionComplete:function(){var i=n("#aGrid_toolbarItems"),t;t=n("#aGrid_delete");i.ejToolbar("disableItem",t)},recordClick:function(){var i=n("#aGrid_toolbarItems"),t,r=this.getSelectedRecords(),u=r.length==0?"disableItem":"enableItem";t=n("#aGrid_delete");i.ejToolbar(u,t)},columns:[{field:"zid",allowEditing:!1,visible:!1},{field:"slug",headerText:t.slug,isPrimaryKey:!0,allowEditing:!1,visible:!1},{field:"single",allowEditing:!1,visible:!1},{field:"priority",headerText:t.priority,allowEditing:!1,visible:!1,width:100},{field:"tax",headerText:t.type,allowEditing:!1},{field:"name",headerText:t.name,allowEditing:!1},{field:"term_slug",allowEditing:!1,visible:!1},{field:"pid",foreignKeyField:"pid",foreignKeyValue:"title",dataSource:places,headerText:t.place,visible:!0}]}).data("ejGrid"),a=n("#sGrid").ejGrid({dataSource:c,locale:i,allowSorting:!0,allowSelection:!0,selectionType:ej.Grid.SelectionType.Single,selectionSettings:{selectionMode:[ej.Grid.SelectionMode.Row],enableToggle:!0},allowPaging:!0,pageSettings:{pageSize:pageSize},editSettings:{allowEditing:!0,allowDeleting:!0,showDeleteConfirmDialog:!0},toolbarSettings:{showToolbar:!0,toolbarItems:[ej.Grid.ToolBarItems.Edit,ej.Grid.ToolBarItems.Update,ej.Grid.ToolBarItems.Cancel,ej.Grid.ToolBarItems.Delete],customToolbarItems:["Refresh","Add"]},toolbarClick:function(t){var i=n(t.target);i.hasClass("Refresh")?this.refreshContent():i.hasClass("Add")&&e.open()},create:function(){n(".Refresh").parent("li").attr("title",t.refresh);n(".Add").parent("li").attr("title",t.add)},actionComplete:function(){var i=n("#sGrid_toolbarItems"),t;t=n("#sGrid_delete");i.ejToolbar("disableItem",t)},recordClick:function(){var i=n("#sGrid_toolbarItems"),t,r=this.getSelectedRecords(),u=r.length==0?"disableItem":"enableItem";t=n("#sGrid_delete");i.ejToolbar(u,t)},columns:[{field:"zid",allowEditing:!1,visible:!1},{field:"slug",headerText:t.slug,isPrimaryKey:!0,allowEditing:!1,visible:!1},{field:"single",allowEditing:!1,visible:!1},{field:"priority",headerText:t.priority,textAlign:ej.TextAlign.Right,editType:ej.Grid.EditingType.Numeric,width:100},{field:"tax",headerText:t.type,allowEditing:!1},{field:"name",headerText:t.name,allowEditing:!1},{field:"term_slug",allowEditing:!1,visible:!1},{field:"pid",foreignKeyField:"pid",foreignKeyValue:"title",dataSource:places,headerText:t.place,visible:!0}]}).data("ejGrid")})})(jQuery)