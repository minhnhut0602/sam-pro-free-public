var sam=sam||{};(function(n){function o(n){for(var i=[],t=0;t<e.length;t++)n&e[t]&&i.push(t);return i}function s(n,t){for(var r=t,i=0;i<n.length;i++)r|=parseInt(n[i].id,10);return r}function h(n,t,i){for(var u=t,f=parseInt(i,10),r=0;r<n.length;r++)u=u&~parseInt(n[r].id,10);return u&~f}var u,f=options.media,r=options.strings,i=options.locale.changeLocale?options.locale.locale:"en-US",t=options.strings,c=options.wap,e=[1,2,4,8,8192,16,32,64,128,256,512,1024,2048,16384,4096];sam.media=u={buttonId:"#banner-media",adUrl:"#img",adImgId:"#img_id",adName:"#title",adDesc:"#description",adLink:"#link",adAlt:"#alt",adFallback:"#swf_fallback",btnFallback:"#fallback-code",init:function(){n(this.buttonId).on("click",this.openMediaDialog);n(this.btnFallback).on("click",this.openMediaDialog)},openMediaDialog:function(n){n.preventDefault();var t="#"+n.currentTarget.id;if(this._frame){this._frame.open();return}this._frame=u.frame=wp.media({title:f.title,button:{text:f.button},multiple:!1,library:{type:"image"}});this._frame.state("library").on("select",function(){var n=this.get("selection").single();u.handleMediaAttachment(n,t)});this._frame.open()},handleMediaAttachment:function(t,i){var r=t.toJSON();if(i==this.buttonId)n(this.adUrl).val(r.url),n(this.adImgId).val(r.id),""==n(this.adName).val()&&""!=r.title&&n(this.adName).val(r.title),""==n(this.adDesc).val()&&""!=r.caption&&n(this.adDesc).val(r.caption),""==n(this.adAlt).val()&&""!=r.alt&&n(this.adAlt).val(r.alt);else if(i==this.btnFallback){var u=n(this.adLink).val(),f=u!=""?'<a href="'+u+'">':"",e='<img src="'+r.url+'">',o=u!=""?"<\/a>":"",s=f+e+o;n(this.adFallback).val(s)}}};n(document).ready(function(){var ot,st,b,g,f,nt,e,tt,c,it,l,rt,a,ut,v,kt,ft,et;n("#tabs").ejTab({enablePersistence:!0});u.init();ot=n("#rc-cmf");st=n("#rc-cmt");n("#amode_false").click(function(){ot.show("blind",{direction:"vertical"},500);st.hide("blind",{direction:"vertical"},500)});n("#amode_true").click(function(){ot.hide("blind",{direction:"vertical"},500);st.show("blind",{direction:"vertical"},500)});var d=n("#ptypes"),w=parseInt(d.val(),10),ur=n("#page-types").ejTreeView({showCheckbox:!0,checkedNodes:o(d.val()),nodeCheck:function(n){w=s(n.currentCheckedNodes,w,n.parentId);d.val(w)},nodeUncheck:function(n){w=h(n.currentUncheckedNodes,w,n.parentId);d.val(w)}}).data("ejTreeView");ur.expandAll();b=n("#rc-vt0");n("input:radio[name=ptype]").on("click",function(){var t=n("input:radio[name=ptype]:checked").val();t==0?b.is(":visible")&&b.hide("blind",{direction:"vertical"},500):t==1&&b.is(":hidden")&&b.show("blind",{direction:"vertical"},500)});var dt=n("#rc-posts"),gt=n("#eposts"),ni=n("#rc-cats"),ti=n("#ecats"),ii=n("#rc-tags"),ri=n("#etags"),ui=n("#rc-authors"),fi=n("#eauthors"),ei=n("#rc-tax"),oi=n("#etax"),si=n("#rc-types"),hi=n("#etypes"),ci=n("#rc-schedule"),li=n("#schedule"),ai=n("#rc-hl"),vi=n("#limit_hits"),yi=n("#rc-cl"),pi=n("#limit_clicks");gt.on("click",function(){gt.is(":checked")?dt.show("blind",{direction:"vertical"},500):dt.hide("blind",{direction:"vertical"},500)});ti.on("click",function(){ti.is(":checked")?ni.show("blind",{direction:"vertical"},500):ni.hide("blind",{direction:"vertical"},500)});ri.on("click",function(){ri.is(":checked")?ii.show("blind",{direction:"vertical"},500):ii.hide("blind",{direction:"vertical"},500)});fi.on("click",function(){fi.is(":checked")?ui.show("blind",{direction:"vertical"},500):ui.hide("blind",{direction:"vertical"},500)});oi.on("click",function(){oi.is(":checked")?ei.show("blind",{direction:"vertical"},500):ei.hide("blind",{direction:"vertical"},500)});hi.on("click",function(){hi.is(":checked")?si.show("blind",{direction:"vertical"},500):si.hide("blind",{direction:"vertical"},500)});li.on("click",function(){li.is(":checked")?ci.show("blind",{direction:"vertical"},500):ci.hide("blind",{direction:"vertical"},500)});vi.on("click",function(){vi.is(":checked")?ai.show("blind",{direction:"vertical"},500):ai.hide("blind",{direction:"vertical"},500)});pi.on("click",function(){pi.is(":checked")?yi.show("blind",{direction:"vertical"},500):yi.hide("blind",{direction:"vertical"},500)});var p={width:830,allowDraggable:!0,enableModal:!0,showOnInit:!1},ht=n("#postsDialog").ejDialog(p).data("ejDialog"),ct=n("#catsDialog").ejDialog(p).data("ejDialog"),lt=n("#tagsDialog").ejDialog(p).data("ejDialog"),at=n("#authorsDialog").ejDialog(p).data("ejDialog"),vt=n("#taxDialog").ejDialog(p).data("ejDialog"),yt=n("#typesDialog").ejDialog(p).data("ejDialog"),k=n("#posts"),y=new Selectors;y.sid=k.val();g=n("#cats");f=new Selectors;f.sid=g.val();nt=n("#tags");e=new Selectors;e.sid=nt.val();tt=n("#authors");c=new Selectors;c.sid=tt.val();it=n("#taxes");l=new Selectors;l.sid=it.val();rt=n("#types");a=new Selectors;a.sid=rt.val();var fr=encodeURI(r.posts),er=encodeURI(r.page),or=ej.DataManager({url:ajaxurl+"?action=load_posts&cstr="+options.data.custList+"&sam_pro_nonce="+options.samProNonce+"&sp="+fr+"&spg="+er+(k.val()==""?"":"&ids="+k.val()),requestType:"json",adaptor:new ej.UrlAdaptor}),sr=ej.DataManager({url:ajaxurl+"?action=load_cats&sam_pro_nonce="+options.samProNonce,requestType:"json",adaptor:new ej.UrlAdaptor}),hr=ej.DataManager({url:ajaxurl+"?action=load_tags&sam_pro_nonce="+options.samProNonce,requestType:"json",adaptor:new ej.UrlAdaptor}),cr=ej.DataManager({url:ajaxurl+"?action=load_authors&sam_pro_nonce="+options.samProNonce,requestType:"json",adaptor:new ej.UrlAdaptor}),lr=ej.DataManager({url:ajaxurl+"?action=load_taxes&sam_pro_nonce="+options.samProNonce,requestType:"json",adaptor:new ej.UrlAdaptor}),ar=ej.DataManager({url:ajaxurl+"?action=load_types&sam_pro_nonce="+options.samProNonce,requestType:"json",adaptor:new ej.UrlAdaptor}),vr=n("#postsGrid").ejGrid({dataSource:or,locale:i,allowSorting:!0,allowSelection:!0,selectionType:ej.Grid.SelectionType.Multiple,selectionSettings:{selectionMode:[ej.Grid.SelectionMode.Row],enableToggle:!0},allowPaging:!0,pageSettings:{pageSize:options.itemsPerPage},columns:[{field:"id",headerText:"ID",textAlign:ej.TextAlign.Right,width:70},{field:"title",headerText:t.name,width:480},{field:"type",headerText:t.type,width:250}],rowSelected:function(n){if(!y.service){y.page=n.model.pageSettings.currentPage;var t=y.pids[y.page].slice(0),i=t.indexOf(n.data.id);i>-1?y.removePid(n.data.id):y.pids=n.data.id}},actionComplete:function(n){var t,i,r=y.ids.slice(0);if(y.service=!0,r.length!=0)for(t=0;t<this.model.currentViewData.length;t++)for(i=0;i<r.length;i++)r[i]==this.model.currentViewData[t].id&&(this.multiSelectCtrlRequest=!0,this.selectRows(t),n.requestType=="paging"?(y.page=n.currentPage,y.pids=this.model.currentViewData[t].id):n.requestType=="refresh"&&(y.page=1,y.pids=this.model.currentViewData[t].id));y.service=!1}}).data("ejGrid"),yr=n("#catsGrid").ejGrid({dataSource:sr,locale:i,allowSorting:!0,allowSelection:!0,selectionType:ej.Grid.SelectionType.Multiple,selectionSettings:{selectionMode:[ej.Grid.SelectionMode.Row],enableToggle:!0},allowPaging:!0,pageSettings:{pageSize:options.itemsPerPage},columns:[{field:"id",headerText:"ID",textAlign:ej.TextAlign.Right,width:70},{field:"title",headerText:t.name,width:480},{field:"slug",headerText:t.slug,width:250}],rowSelected:function(n){if(!f.service){f.page=n.model.pageSettings.currentPage;var t=f.pids[f.page].slice(0),i=t.indexOf(n.data.slug);i>-1?f.removePid(n.data.slug):f.pids=n.data.slug}},actionComplete:function(n){var t,i,r=f.ids.slice(0);if(f.service=!0,r.length!=0)for(t=0;t<this.model.currentViewData.length;t++)for(i=0;i<r.length;i++)r[i]==this.model.currentViewData[t].slug&&(this.multiSelectCtrlRequest=!0,this.selectRows(t),n.requestType=="paging"?(f.page=n.currentPage,f.pids=this.model.currentViewData[t].slug):n.requestType=="refresh"&&(f.page=1,f.pids=this.model.currentViewData[t].slug));f.service=!1}}).data("ejGrid"),pr=n("#tagsGrid").ejGrid({dataSource:hr,locale:i,allowSorting:!0,allowSelection:!0,selectionType:ej.Grid.SelectionType.Multiple,selectionSettings:{selectionMode:[ej.Grid.SelectionMode.Row],enableToggle:!0},allowPaging:!0,pageSettings:{pageSize:options.itemsPerPage},columns:[{field:"id",headerText:"ID",textAlign:ej.TextAlign.Right,width:70},{field:"title",headerText:t.name,width:480},{field:"slug",headerText:t.slug,width:250}],rowSelected:function(n){if(!e.service){e.page=n.model.pageSettings.currentPage;var t=e.pids[e.page].slice(0),i=t.indexOf(n.data.slug);i>-1?e.removePid(n.data.slug):e.pids=n.data.slug}},actionComplete:function(n){var t,i,r=e.ids.slice(0);if(e.service=!0,r.length!=0)for(t=0;t<this.model.currentViewData.length;t++)for(i=0;i<r.length;i++)r[i]==this.model.currentViewData[t].slug&&(this.multiSelectCtrlRequest=!0,this.selectRows(t),n.requestType=="paging"?(e.page=n.currentPage,e.pids=this.model.currentViewData[t].slug):n.requestType=="refresh"&&(e.page=1,e.pids=this.model.currentViewData[t].slug));e.service=!1}}).data("ejGrid"),wr=n("#authorsGrid").ejGrid({dataSource:cr,locale:i,allowSorting:!0,allowSelection:!0,selectionType:ej.Grid.SelectionType.Multiple,selectionSettings:{selectionMode:[ej.Grid.SelectionMode.Row],enableToggle:!0},allowPaging:!0,pageSettings:{pageSize:options.itemsPerPage},columns:[{field:"id",headerText:"ID",textAlign:ej.TextAlign.Right,width:70},{field:"title",headerText:t.name,width:480},{field:"slug",headerText:t.slug,width:250}],rowSelected:function(n){if(!c.service){c.page=n.model.pageSettings.currentPage;var t=c.pids[c.page].slice(0),i=t.indexOf(n.data.slug);i>-1?c.removePid(n.data.slug):c.pids=n.data.slug}},actionComplete:function(n){var t,i,r=c.ids.slice(0);if(c.service=!0,r.length!=0)for(t=0;t<this.model.currentViewData.length;t++)for(i=0;i<r.length;i++)r[i]==this.model.currentViewData[t].slug&&(this.multiSelectCtrlRequest=!0,this.selectRows(t),n.requestType=="paging"?(c.page=n.currentPage,c.pids=this.model.currentViewData[t].slug):n.requestType=="refresh"&&(c.page=1,c.pids=this.model.currentViewData[t].slug));c.service=!1}}).data("ejGrid"),br=n("#taxGrid").ejGrid({dataSource:lr,locale:i,allowSorting:!0,allowSelection:!0,selectionType:ej.Grid.SelectionType.Multiple,selectionSettings:{selectionMode:[ej.Grid.SelectionMode.Row],enableToggle:!0},allowPaging:!0,pageSettings:{pageSize:options.itemsPerPage},columns:[{field:"id",headerText:"ID",textAlign:ej.TextAlign.Right,width:70},{field:"title",headerText:t.termName,width:480},{field:"ctax_name",headerText:t.ctName,width:250},{field:"slug",headerText:t.slug,visible:!1}],rowSelected:function(n){if(!l.service){l.page=n.model.pageSettings.currentPage;var t=l.pids[l.page].slice(0),i=t.indexOf(n.data.slug);i>-1?l.removePid(n.data.slug):l.pids=n.data.slug}},actionComplete:function(n){var t,i,r=l.ids.slice(0);if(l.service=!0,r.length!=0)for(t=0;t<this.model.currentViewData.length;t++)for(i=0;i<r.length;i++)r[i]==this.model.currentViewData[t].slug&&(this.multiSelectCtrlRequest=!0,this.selectRows(t),n.requestType=="paging"?(l.page=n.currentPage,l.pids=this.model.currentViewData[t].slug):n.requestType=="refresh"&&(l.page=1,l.pids=this.model.currentViewData[t].slug));l.service=!1}}).data("ejGrid"),kr=n("#typesGrid").ejGrid({dataSource:ar,locale:i,allowSorting:!0,allowSelection:!0,selectionType:ej.Grid.SelectionType.Multiple,selectionSettings:{selectionMode:[ej.Grid.SelectionMode.Row],enableToggle:!0},columns:[{field:"title",headerText:t.ctt,width:480},{field:"slug",headerText:t.ctSlug,width:250}],rowSelected:function(n){if(!a.service){a.page=n.model.pageSettings.currentPage;var t=a.pids[a.page].slice(0),i=t.indexOf(n.data.slug);i>-1?a.removePid(n.data.slug):a.pids=n.data.slug}},actionComplete:function(n){var t,i,r=a.ids.slice(0);if(a.service=!0,r.length!=0)for(t=0;t<this.model.currentViewData.length;t++)for(i=0;i<r.length;i++)r[i]==this.model.currentViewData[t].slug&&(this.multiSelectCtrlRequest=!0,this.selectRows(t),n.requestType=="paging"?(a.page=n.currentPage,a.pids=this.model.currentViewData[t].slug):n.requestType=="refresh"&&(a.page=1,a.pids=this.model.currentViewData[t].slug));a.service=!1}}).data("ejGrid");n("#cancel-posts").on("click",function(){ht.close()});n("#select-posts").on("click",function(){k.val(y.sid);ht.close()});n("#showPosts").on("click",function(n){n.preventDefault();y.sid=k.val();vr.refreshContent();ht.open()});n("#cancel-cats").on("click",function(){ct.close()});n("#select-cats").on("click",function(){g.val(f.sid);ct.close()});n("#showCats").on("click",function(n){n.preventDefault();f.sid=g.val();yr.refreshContent();ct.open()});n("#cancel-tags").on("click",function(){lt.close()});n("#select-tags").on("click",function(){nt.val(e.sid);lt.close()});n("#showTags").on("click",function(n){n.preventDefault();e.sid=nt.val();pr.refreshContent();lt.open()});n("#cancel-authors").on("click",function(){at.close()});n("#select-authors").on("click",function(){tt.val(c.sid);at.close()});n("#showAuthors").on("click",function(n){n.preventDefault();c.sid=tt.val();wr.refreshContent();at.open()});n("#cancel-tax").on("click",function(){vt.close()});n("#select-tax").on("click",function(){it.val(l.sid);vt.close()});n("#showTaxes").on("click",function(n){n.preventDefault();l.sid=it.val();br.refreshContent();vt.open()});n("#cancel-types").on("click",function(){yt.close()});n("#select-types").on("click",function(){rt.val(a.sid);yt.close()});n("#showTypes").on("click",function(n){n.preventDefault();a.sid=rt.val();kr.refreshContent();yt.open()});var wi=n("#sdate"),bi=n("#fdate"),uu=n("#startDate").ejDateTimePicker({width:250,locale:i,buttonText:options.buttonText,dateTimeFormat:"yyyy-MM-dd HH:mm:ss",timeDisplayFormat:"HH:mm:ss",value:wi.val(),change:function(n){wi.val(n.value)}}).data("ejDateTimePicker"),fu=n("#finishDate").ejDateTimePicker({width:250,locale:i,buttonText:options.buttonText,dateTimeFormat:"yyyy-MM-dd HH:mm:ss",timeDisplayFormat:"HH:mm:ss",value:bi.val(),change:function(n){bi.val(n.value)}}).data("ejDateTimePicker"),ki=n("#custom-users"),dr=n("input:radio[name=users]"),di=n("#x-reg-users"),gi=n("#users_reg"),nr=n("#x-view-users"),tr=n("#xusers");dr.on("click",function(){var t=n("input:radio[name=users]:checked").val();t==0?ki.hide("blind",{direction:"vertical"},500):ki.show("blind",{direction:"vertical"},500)});gi.on("click",function(){gi.is(":checked")?di.show("blind",{direction:"vertical"},500):di.hide("blind",{direction:"vertical"},500)});tr.on("click",function(){tr.is(":checked")?nr.show("blind",{direction:"vertical"},500):nr.hide("blind",{direction:"vertical"},500)});ut=n("#xvusers");v=new Selectors;v.sid=ut.val();var pt=n("#usersDialog").ejDialog(p).data("ejDialog"),gr="&subscriber="+encodeURI(r.subscriber)+"&contributor="+encodeURI(r.contributor)+"&author="+encodeURI(r.author)+"&editor="+encodeURI(r.editor)+"&admin="+encodeURI(r.admin)+"&sadmin="+encodeURI(r.superAdmin),nu=ej.DataManager({url:ajaxurl+"?action=load_users&sam_pro_nonce="+options.samProNonce+gr,requestType:"json",adaptor:new ej.UrlAdaptor}),tu=n("#usersGrid").ejGrid({dataSource:nu,locale:i,allowSorting:!0,allowSelection:!0,selectionType:ej.Grid.SelectionType.Multiple,selectionSettings:{selectionMode:[ej.Grid.SelectionMode.Row],enableToggle:!0},allowPaging:!0,pageSettings:{pageSize:options.itemsPerPage},columns:[{field:"id",headerText:"ID",textAlign:ej.TextAlign.Right,width:70},{field:"title",headerText:t.display,width:330},{field:"slug",headerText:t.user,width:250},{field:"role",headerText:t.role,width:150}],rowSelected:function(n){if(!v.service){v.page=n.model.pageSettings.currentPage;var t=v.pids[v.page].slice(0),i=t.indexOf(n.data.slug);i>-1?v.removePid(n.data.slug):v.pids=n.data.slug}},actionComplete:function(n){var t,i,r=v.ids.slice(0);if(v.service=!0,r.length!=0)for(t=0;t<this.model.currentViewData.length;t++)for(i=0;i<r.length;i++)r[i]==this.model.currentViewData[t].slug&&(this.multiSelectCtrlRequest=!0,this.selectRows(t),n.requestType=="paging"?(v.page=n.currentPage,v.pids=this.model.currentViewData[t].slug):n.requestType=="refresh"&&(v.page=1,v.pids=this.model.currentViewData[t].slug));v.service=!1}}).data("ejGrid");n("#cancel-users").on("click",function(){pt.close()});n("#select-users").on("click",function(){ut.val(v.sid);pt.close()});n("#showXUsers").on("click",function(n){n.preventDefault();v.sid=ut.val();tu.refreshContent();pt.open()});var iu=options.advertisers,wt=n("#advertsDialog").ejDialog(p).data("ejDialog"),ru=n("#advertsGrid").ejGrid({dataSource:ej.DataManager(iu),locale:i,allowSorting:!0,allowSelection:!0,allowFiltering:!0,filterSettings:{filterType:"menu"},selectionType:ej.Grid.SelectionType.Single,selectionSettings:{selectionMode:[ej.Grid.SelectionMode.Row],enableToggle:!0},allowPaging:!0,pageSettings:{pageSize:options.itemsPerPage},columns:[{field:"owner",headerText:t.nick},{field:"owner_name",headerText:t.display},{field:"owner_mail",headerText:t.mail}]}).data("ejGrid");n("#select-adverts").on("click",function(){var i=ru.model.selectedRecords,t;i.length==1&&(t=i[0],n("#owner").val(t.owner),n("#owner_name").val(t.owner_name),n("#owner_mail").val(t.owner_mail));wt.close()});n("#cancel-adverts").on("click",function(){wt.close()});n("#showAdvertisers").on("click",function(n){n.preventDefault();wt.open()});var ir=n("#swf"),rr=n("#swf-params"),bt=n("#link"),eu=n("#alt");ir.on("click",function(){ir.is(":checked")?rr.show("blind",{direction:"vertical"},500):rr.hide("blind",{direction:"vertical"},500)});ft=n("#click-tag");et=n("#swf_vars");bt.on("change",function(){this.value==""?ft.prop("disabled",!0):ft.prop("disabled",!1)});ft.on("click",function(n){n.preventDefault();var t=et.val();kt=bt.val();""==t?et.val('{clickTAG: escape("'+kt+'")}'):et.val(t.replace("}",', clickTAG: escape("'+kt+'")}'));bt.val("")})})})(jQuery)