(function(n){var u=[],i=0,r=options.locale.changeLocale?options.locale.locale:"en-US",t=options.strings;n(document).ready(function(){function a(u){i=u;l=ej.DataManager({url:ajaxurl+"?action=list_ads&pid="+u+"&sam_pro_nonce="+options.samProNonce,requestType:"json",adaptor:new ej.UrlAdaptor});s=n("#adsGrid").ejGrid({dataSource:l,locale:r,allowTextWrap:!0,allowPaging:!0,pageSettings:{pageSize:options.itemsPerPage},allowSorting:!0,allowSelection:!0,selectionType:ej.Grid.SelectionType.Multiple,selectionSettings:{selectionMode:[ej.Grid.SelectionMode.Row],enableToggle:!0},columns:[{field:"aid",headerText:t.adId,isPrimaryKey:!0,textAlign:ej.TextAlign.Right,width:120},{field:"title",headerText:t.name,width:280},{field:"description",headerText:t.desc},{field:"asize",headerText:t.size,width:100}],rowSelected:function(n){if(!f.service){f.page=n.model.pageSettings.currentPage;var t=f.pids[f.page].slice(0),i=t.indexOf(n.data.aid);i>-1?f.removePid(n.data.aid):f.pids=n.data.aid}},actionComplete:function(n){var t,i,r=f.ids.slice(0);if(f.service=!0,r.length!=0)for(t=0;t<this.model.currentViewData.length;t++)for(i=0;i<r.length;i++)r[i]==this.model.currentViewData[t].aid&&(this.multiSelectCtrlRequest=!0,this.selectRows(t),n.requestType=="paging"?(f.page=n.currentPage,f.pids=this.model.currentViewData[t].aid):n.requestType=="refresh"&&(f.page=1,f.pids=this.model.currentViewData[t].aid));f.service=!1}}).data("ejGrid");f.sid="";h.open()}var l,s,h=n("#adsDialog").ejDialog({width:830,allowDraggable:!0,enableModal:!0,showOnInit:!1}).data("ejDialog"),f=new Selectors,e,c;n("#cancel-ads").on("click",function(){h.close();s.destroy();i=0});n("#select-ads").on("click",function(){var t=f.sid;t!=""&&i!=0&&n.post(ajaxurl+"?action=link_ads",{pid:i,sid:t,sam_pro_nonce:options.samProNonce}).done(function(){e.refreshContent()});h.close();s.destroy();i=0});var o,v=ej.DataManager({url:ajaxurl+"?action=load_places&sam_pro_nonce="+options.samProNonce,removeUrl:ajaxurl+"?action=remove_place&sam_pro_nonce="+options.samProNonce,requestType:"json",adaptor:new ej.UrlAdaptor}),y=ej.DataManager({url:ajaxurl+"?action=load_places_ads&sam_pro_nonce="+options.samProNonce,removeUrl:ajaxurl+"?action=remove_place_ad&sam_pro_nonce="+options.samProNonce,updateUrl:ajaxurl+"?action=update_place_ad&sam_pro_nonce="+options.samProNonce,requestType:"json",adaptor:new ej.UrlAdaptor}),p=ej.DataManager({url:ajaxurl+"?action=lookup_ads&sam_pro_nonce="+options.samProNonce,requestType:"json",adaptor:new ej.UrlAdaptor,offline:!0}),w=ej.Query(),b=p.executeQuery(w);b.done(function(n){for(var t=0,f=n.result.count,r=n.result.result,i,t=0;t<f;t++)i={},i.text=r[t].aid+". "+r[t].title,i.value=r[t].aid,u.push(i)});e=n("#grid").ejGrid({dataSource:v,locale:r,allowTextWrap:!0,allowPaging:!0,pageSettings:{pageSize:options.itemsPerPage},allowSorting:!0,allowFiltering:!0,filterSettings:{filterType:"menu"},allowSelection:!0,selectionSettings:{selectionMode:[ej.Grid.SelectionMode.Row],enableToggle:!0},editSettings:{allowDeleting:!0,showDeleteConfirmDialog:!0},toolbarSettings:{showToolbar:!0,customToolbarItems:[{templateID:"#viewMode"},"Expand","Collapse","Refresh",{templateID:"#NewPlace"},"Edit","Link",{templateID:"#TrashPlace"},{templateID:"#UnTrashPlace"}],toolbarItems:[ej.Grid.ToolBarItems.Delete]},actionComplete:function(){var i=n("#grid_toolbarItems"),t;t=n("#grid_delete");i.ejToolbar("disableItem",t);t=n("#grid_Edit");i.ejToolbar("disableItem",t);t=n("#grid_Link");i.ejToolbar("disableItem",t);t=n("#grid_TrashPlace");i.ejToolbar("disableItem",t);t=n("#grid_UnTrashPlace");i.ejToolbar("disableItem",t)},recordClick:function(){var i=n("#grid_toolbarItems"),t,u=this.getSelectedRecords(),r=u.length==0?"disableItem":"enableItem";t=n("#grid_delete");i.ejToolbar(r,t);t=n("#grid_Edit");i.ejToolbar(r,t);t=n("#grid_Link");i.ejToolbar(r,t);t=n("#grid_TrashPlace");i.ejToolbar(r,t);t=n("#grid_UnTrashPlace");i.ejToolbar(r,t)},toolbarClick:function(t){var i=n(t.target),r=this.getSelectedRecords(),u,s,f,h,l,v;i.hasClass("Expand")?this.expandAll():i.hasClass("Collapse")?this.collapseAll():i.hasClass("Refresh")?(u=parseInt(c.getSelectedValue(),10),u==0?e._disabledToolItems.push(o[6]):u==1&&e._disabledToolItems.push(o[5]),this.refreshContent()):i.hasClass("Edit")?r.length>0&&(s=r[0].pid,document.location=options.editorUrl+s):i.hasClass("place-to-trash")||i.hasClass("place-from-trash")?(f=i.hasClass("place-to-trash")?1:0,r.length>0&&(h=parseInt(r[0].pid,10),l=parseInt(r[0].trash,10),l!=f&&n.post(ajaxurl,{action:"trash_place",pid:h,trash:f,sam_pro_nonce:options.samProNonce}).done(function(){var n=parseInt(c.getSelectedValue(),10);n==0?e._disabledToolItems.push(o[6]):n==1&&e._disabledToolItems.push(o[5]);e.refreshContent()}))):i.hasClass("Link")&&t.model.selectedRowIndex!=-1&&(v=t.model.currentViewData[t.model.selectedRowIndex].pid,a(v))},columns:[{field:"pid",headerText:t.id,isPrimaryKey:!0,foreignKeyField:"pid",textAlign:ej.TextAlign.Right,width:120},{field:"title",headerText:t.name,width:250},{field:"description",headerText:t.desc},{field:"psize",headerText:t.size,width:200},{field:"stat",headerText:t.status,textAlign:ej.TextAlign.Center,allowFiltering:!1,width:100},{field:"trash",headerText:"Trash",visible:!1}],create:function(){var i=n("#grid_toolbarItems");o=i.find("li");n(".Expand").parent("li").attr("title",t.expand);n(".Collapse").parent("li").attr("title",t.collapse);n(".Refresh").parent("li").attr("title",t.refresh);n(".Edit").parent("li").attr("title",t.edit);n("#view-mode").parent("li").attr("title",t.viewMode);n(".place-to-trash").parent("li").attr("title",t.moveToTrash);n(".place-from-trash").parent("li").attr("title",t.restoreFromTrash);n(".new-ad").parent("li").attr("title",t.newPlace);n(".Link").parent("li").attr("title",t.linkAds)},childGrid:{dataSource:y,locale:r,queryString:"pid",allowSorting:!1,allowSelection:!0,selectionSettings:{selectionMode:[ej.Grid.SelectionMode.Row],enableToggle:!0},editSettings:{allowEditing:!0,allowDeleting:!0,showDeleteConfirmDialog:!0},toolbarSettings:{showToolbar:!0,toolbarItems:["edit",ej.Grid.ToolBarItems.Update,ej.Grid.ToolBarItems.Cancel],customToolbarItems:[{templateID:"#Trash"},"Edit_Ad"]},columns:[{field:"pid",headerText:"Place ID",isPrimaryKey:!0,visible:!1},{field:"aid",headerText:t.adId,isPrimaryKey:!0,allowEditing:!1,textAlign:ej.TextAlign.Right,width:100},{field:"title",headerText:t.name,allowEditing:!1,width:250},{field:"description",headerText:t.desc,allowEditing:!1},{field:"weight",headerText:t.weight,textAlign:ej.TextAlign.Right,allowEditing:!0,editType:ej.Grid.EditingType.Numeric,defaultValue:10,width:150},{field:"trash",headerText:t.status,allowEditing:!1,textAlign:ej.TextAlign.Center,width:100}],create:function(){n(".to-trash").parent("li").attr("title",t.unlinkAd);n(".Edit_Ad").parent("li").attr("title",t.editAd)},actionComplete:function(){var i=n("#"+this._id+"_toolbarItems"),t;t=n("#"+this._id+"_Trash");i.ejToolbar("disableItem",t);t=n("#"+this._id+"_Edit_Ad");i.ejToolbar("disableItem",t)},recordClick:function(){var i=n("#"+this._id+"_toolbarItems"),t,u=this.getSelectedRecords(),r=u.length==0?"disableItem":"enableItem";t=n("#"+this._id+"_Trash");i.ejToolbar(r,t);t=n("#"+this._id+"_Edit_Ad");i.ejToolbar(r,t)},toolbarClick:function(t){var i=n(t.target),r=this.getSelectedRecords(),u;i.hasClass("to-trash")?n.post(ajaxurl+"?action=unlink_ad",{pid:t.model.currentViewData[t.model.selectedRowIndex].pid,aid:t.model.currentViewData[t.model.selectedRowIndex].aid,sam_pro_nonce:options.samProNonce}).done(function(n){n.success&&e.refreshContent()}):i.hasClass("Edit_Ad")&&r.length>0&&(u=r[0].aid,document.location=options.adEditorUrl+u)}}}).data("ejGrid");c=n("#view-mode").ejDropDownList({selectedItemIndex:0,change:function(){var t=parseInt(this.getSelectedValue(),10);t!=10?n("#grid").ejGrid("model.query",(new ej.Query).where("trash",ej.FilterOperators.equal,t,10)):n("#grid").ejGrid("model.query",new ej.Query);t==0?e._disabledToolItems.push(o[6]):t==1&&e._disabledToolItems.push(o[5]);e.refreshContent(!0)}}).data("ejDropDownList")})})(jQuery)